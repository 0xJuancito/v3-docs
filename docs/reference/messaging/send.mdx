import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Send a message

Contracts can send interchain messages by calling the `dispatch` function on the Mailbox.

:::warning
Hyperlane can only deliver messages to smart contracts that implement the `IMessageRecipient` interface. See the [Handle](./receive.mdx "mention") documentation for more information.
:::

## Dispatch

Calling this function dispatches a message to the destination domain and recipient. Depending on the post-`dispatch` [hook configuration](../hooks/overview.mdx), some payment may be required. See the [`quoteDispatch`](##quote-dispatch) section for more information.

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/static/contracts/Mailbox.sol#L102-L106
```

**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_destinationDomain`|`uint32`|Domain of destination chain|
|`_recipientAddress`|`bytes32`|Address of recipient on destination chain as bytes32|
|`_messageBody`|`bytes`|Raw bytes content of message body|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`bytes32`|The unique message identifier|

:::tip
Recipient addresses are left-padded to `bytes32` for compatibility with virtual machines that are addressed differently.
:::

The following utility is provided in the [`TypeCasts` library](../libraries/typecasts.mdx "mention") for convenience.
```solidity file=<rootDir>/static/contracts/libs/TypeCasts.sol#L5-L8
```

</TabItem>
<TabItem value="cw" label="CosmWasm">

Docs coming soon!

</TabItem>
<TabItem value="sl" label="Sealevel">

Docs coming soon!

</TabItem>
</Tabs>

## Quote Dispatch

To receive a quote for a corresponding `dispatch` call, you can query the `quoteDispatch` function. 

:::info
Fees are often configured to cover extra-protocol costs. These include transaction submission on the destination chain, security provisioning, and maintenance.
:::

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/static/contracts/Mailbox.sol#L149-L153
```

**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`destinationDomain`|`uint32`|Domain of destination chain|
|`recipientAddress`|`bytes32`|Address of recipient on destination chain as bytes32|
|`messageBody`|`bytes`|Raw bytes content of message body|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`fee`|`uint256`|The payment required to dispatch the message|

</TabItem>
<TabItem value="cw" label="CosmWasm">

Docs coming soon!

</TabItem>
<TabItem value="sl" label="Sealevel">

Docs coming soon!

</TabItem>
</Tabs>

## Post-Dispatch Hook Config

There are two Mailbox hooks that are configured by the `owner`: required and default. The required hook will be invoked for all `dispatch` calls and the default hook will be invoked unless overriden. See the [Hooks](../hooks/overview.mdx "mention") documentation for more information.

{/* TODO: add diagram */}

### Required

To query the required hook configuration, you can call the `requiredHook` function.

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/static/contracts/interfaces/IMailbox.sol#L55
```

</TabItem>
</Tabs>

### Default

To query the default hook configuration, you can call the `defaultHook` function.

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/static/contracts/interfaces/IMailbox.sol#L53
```

</TabItem>
</Tabs>

### Overriding default hook metadata

To override the default hook metadata, there is a `dispatch` overload that accepts a `metadata` parameter to be used in the configured `defaultHook`.

:::tip
Overriding the default hook metadata is an advanced feature. See the [Hooks](../hooks/overview.mdx "mention") documentation for more information.
:::

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/static/contracts/Mailbox.sol#L125-L130
```

</TabItem>
</Tabs>

### Overriding the default hook and metadata

To override the default hook configuration, there is a `dispatch` overload that accepts a `hook` and hook `metadata` parameters.

:::tip
Overriding the default hook is an advanced feature. See the [Hooks](../hooks/overview.mdx "mention") documentation for more information.
:::

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/static/contracts/Mailbox.sol#L270-L276
```

</TabItem>
</Tabs>
